<html>
<head>
  <link rel="stylesheet" type="text/css" href="./style.css">
</head>
<body>
  <h1>Members:</h1>
  <ul style="float:left;">
    <li>Alexander Novotny</li>
    <li>Corey Pena</li>
    <li>Sharon Phillips</li>
    <li>Jaime Parra-Alvarez</li>
  </ul>
  
  <form style="float:left;margin-left:50px" id="form">
    <span style="font-weight:bold;">Contact us:</span><br>
    Subject: <input type="text" name="subject" id="subject" style="width:350px;margin-left:20px;" pattern="/^{1,}$/" required="required"><br>
    From: <input type="email" name="from" id="from" required="required" style="width:350px;margin-left:32px;margin-top:10px;margin-bottom:10px;"><br>
    <span style="float:left">Content:</span> <textarea id="content" style="width:400px;height:200px;margin-left:21px;float:right;" required="required" pattern="/^{1,}$/"></textarea><br>
    <div style="clear:both"></div>
    <input type="submit" name="send" id="send" value="Send" style="float:right;margin:7px;">
    <span id="errorSpan" style="color:red;float:right;margin:7px;"></span>
  </form>

  <div style="clear:both"></div>
  <a href="https://docs.google.com/document/d/1Aj3fp8QWXLQRRn3g9tQr0kwzdLheQVwt7RJfu8zvo0c/edit?usp=sharing">Project Document</a>

  <br>

  <table id="vidTable" border="1">
    <!-- <tr>
      <td class="rowHeader"></td>
      <td class="rowHeader">Alexander Novotny</td>
      <td class="rowHeader">Corey Pena</td>
      <td class="rowHeader">Sharon Phillips</td>
      <td class="rowHeader">Jaime Parra-Alvarez</td>
    </tr>
    <tr>
      <td class="rowHeader">Planning</td>
      <td><img src="Thumbs/Alexander/I-Love-Lucy-Vitameatavegamin.png" class="thumb"></td>
    </tr>
    <tr>
      <td class="rowHeader">Fucking Tables</td>
    </tr>
    <tr>
      <td class="rowHeader">Execution</td>
    </tr>
    <tr>
      <td class="rowHeader">Risk Management</td>
    </tr>
    <tr>
      <td class="rowHeader">Quality Control</td>
    </tr>
    <tr>
      <td class="rowHeader">Communications</td>
    </tr> -->
  </table>
  <!--<video style="width:175px;height:auto;">-->
  <video id="video">
    Your browser does not support HTML 5 video!
  </video>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      $("#form").submit(onFormSubmit);
      setupTable();
    });

    function setupTable() {
      var tableHTML = "<tr>";
      tableHTML += "<td class=\"rowHeader\"></td>";
      for(var member in values.members) {
        tableHTML += "<td class=\"rowHeader\">" + member + "</td>";
      }
      tableHTML += "</tr>";

      for(var category of values.categories) {
        tableHTML += "<tr>";
        tableHTML += "<td class=\"rowHeader\">" + category + "</td>";
        for(var member in values.members) {
          tableHTML += "<td>";
          if("videos" in values.members[member] && category in values.members[member].videos) {
            tableHTML += "<a href=\"#\"><img src=\"Thumbs/" + member + "/" + values.members[member].videos[category].thumb + "\" class=\"thumb\" onclick=\"thumbClick('" + member + "', '" + category + "')\"></a>";
          }
          tableHTML += "</td>";
        }
        tableHTML += "<tr>";
      }
      $("#vidTable").html(tableHTML);
    }

    function thumbClick(member, category) {
      console.log("Displaying " + member + "'s " + category + " video.")
    }

    function onFormSubmit(e) {
      var subject = $("#subject").val();
      var from = $("#from").val();
      var content = $("#content").val();

      if(subject == "") {
        $("#errorSpan").text("There needs to be a subject!");
        return;
      }
      if(from == "") {
        $("#errorSpan").text("There needs to be a sender!");
        return;
      }
      if(content == "") {
        $("#errorSpan").text("There needs to be content!");
        return;
      }

      console.log("blah");

      $("#errorSpan").text("");

      var to = [];
      for(var member in values.members) {
        to.push({
          email: values.members[member].email,
          name: member,
          type: "to"
        });
      }

      $.ajax({
        type: "POST",
        url: "https://mandrillapp.com/api/1.0/messages/send.json",
        data: {
          'key': 'XGC63WW2JNXqMwyEswTUxA',
          'message': {
            'from_email': from,
            'to': to,
            'autotext': "true",
            'subject': subject,
            'html': content
          }
        }
      }).done(function(response) {
        if(response[0].status = "sent") {
          $("#errorSpan").css("color", "green");
          $("#errorSpan").text("E-mail sent!");

          $("#subject").val("");
          $("#from").val("");
          $("#content").val("");
        }
      });

      return false;
    }

    var values = {
      categories: ["Planning", "Execution", "Risk Management", "Quality Control", "Communications"],
      members: {
        "Alexander Novotny": {
          email: "alexander_novo@mail.tmcc.edu",
          videos: {
            "Planning": {
              source: "I-Love-Lucy-Vitameatavegamin.webm",
              type: "video/webm",
              thumb: "I-Love-Lucy-Vitameatavegamin.png",
              description: "This was a good fit because blah..."
            }
          }
        },
        "Corey Pena": {
          email: "CoreyPena@gmail.com"
        },
        "Sharon Phillips": {
          email: "Sharonaphillips61@gmail.com",
          videos: {
            "Planning": {
              source: "plansharon1.mp4",
              type: "video/mp4",
              thumb: "default.png",
              description: "This was a good fit because blah..."
            },
            "Execution": {
              source: "exsharon.mp4",
              type: "video/mp4",
              thumb: "default.png",
              description: "This was a good fit because blah..."
            },
            "Risk Management": {
              source: "rmsharon.mp4",
              type: "video/mp4",
              thumb: "default.png",
              description: "This was a good fit because blah..."
            },
            "Quality Control": {
              source: "QCsharon.mp4",
              type: "video/mp4",
              thumb: "default.png",
              description: "This was a good fit because blah..."
            },
            "Communications": {
              source: "commSHARON.mp4",
              type: "video/mp4",
              thumb: "default.png",
              description: "This was a good fit because blah..."
            }
          }
        },
        "Jaime Parra-Alvarez": {
          email: "pckillagoku@gmail.com"
        }

      }

    }
  </script>
</body>
</html>
